name: TriggerCalc CI/CD

# –ó–∞–ø—É—Å–∫–∞—Ç–∏ —Ü–µ–π —Å—Ü–µ–Ω–∞—Ä—ñ–π, –∫–æ–ª–∏ –º–∏ —Ä–æ–±–∏–º–æ push —É –≥—ñ–ª–∫—É main
on:
  push:
    branches: [ "main" ]
  # –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É –∫–Ω–æ–ø–∫—É "Run workflow" —É –≤–∫–ª–∞–¥—Ü—ñ Actions
  workflow_dispatch:

# –î–æ–∑–≤–æ–ª–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–ª—ñ–∑—ñ–≤
permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –Ω–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—É –º–∞—à–∏–Ω—É
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. –í–∏–≤—ñ–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∞–≤—Ç–æ—Ä–∞
      - name: Print Author Info
        run: |
          echo "=========================================="
          echo "üöÄ Starting CI/CD Pipeline for TriggerCalc"
          echo "üë§ Author: Kosaruk Zakhar (Group KV-32)"
          echo "üìÖ Date: $(date)"
          echo "=========================================="

      # 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è (Build)
      # –ú–∏ –∞—Ä—Ö—ñ–≤—É—î–º–æ –ø–∞–ø–∫—É Assets —Ç–∞ ProjectSettings —è–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–±—ñ—Ä–∫–∏
      - name: Build Project (Create Archive)
        run: |
          echo "üõ†Ô∏è Building project artifact..."
          mkdir build
          zip -r build/TriggerCalc_Build.zip Assets ProjectSettings
          echo "‚úÖ Build completed successfully!"

      # 4. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ–≥—É –¥–ª—è —Ä–µ–ª—ñ–∑—É (–Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞—Ç–∏ —Ç–∞ —á–∞—Å—É)
      - name: Generate Release Tag
        id: tag
        run: echo "release_tag=v1.0.$(date +%s)" >> $GITHUB_OUTPUT

      # 5. –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è —Ä–µ–ª—ñ–∑–∞ –≤ GitHub 
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag.outputs.release_tag }}
          name: Release ${{ steps.tag.outputs.release_tag }}
          body: |
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–ª—ñ–∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ ‚Ññ6.
            
            **–ó–º—ñ–Ω–∏:**
            - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É TriggerCalc.
            - –ê–≤—Ç–æ—Ä: –ö–æ—Å–∞—Ä—É–∫ –ó–∞—Ö–∞—Ä, –ö–í-32.
          files: build/TriggerCalc_Build.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
